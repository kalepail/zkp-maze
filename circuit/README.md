# Noir Circuit

Zero-knowledge circuit for verifying maze solutions. Proves you found a valid path from start to end without revealing your moves.

## Architecture

```
Input: moves[500], maze_seed
  ↓
Verify maze identity (seed)
  ↓
Start at (1, 1)
  ↓
For each move:
  - Check bounds (< 41)
  - Check walls (cell == 1)
  - Update position
  ↓
Assert reached (40, 40)
  ↓
Output: Proof
```

## Files

- `src/main.nr` - Main circuit logic with security validations
- `src/maze_config.nr` - Generated maze configuration (41x41 grid)
- `src/test_solutions.nr` - Test solution paths
- `Nargo.toml` - Noir project configuration
- `Prover.toml` - Witness inputs for proof generation

## Security Model

The circuit enforces:
1. Maze identity via seed verification
2. Fixed start position (1, 1)
3. Sequential movement (±1 per move)
4. Bounds checking (all positions < 41)
5. Wall collision detection (all cells = 1)
6. Goal achievement (reach 40, 40)

Invalid directions result in no-ops (secure by design - saves ~3,500 gates).

## Development

### Prerequisites

- [Noir](https://noir-lang.org/docs/getting_started/installation/) v1.0.0-beta.9+
- [Barretenberg](https://github.com/AztecProtocol/aztec-packages/tree/master/barretenberg) CLI

### Commands

```bash
# Compile circuit
nargo compile

# Run tests
nargo test

# Execute with witness
nargo execute

# Check circuit (no test execution)
nargo check
```

### Generate Maze

From project root:

**Use existing seed (2918957128):**
```bash
pnpm run generate  # Generates with default seed
pnpm run nargo     # Build circuit
```

**Generate new maze with custom seed:**
```bash
python3 generate_maze.py <your-seed> --no-preview
pnpm run nargo     # Build circuit
```

Both update `src/maze_config.nr` and `Prover.toml` with the new maze.

## Integration

### Circuit Artifacts

After compilation:
- `target/circuit.json` - Circuit bytecode (copy to worker)
- `target/circuit.gz` - Witness data (after nargo execute)

### Copy to Worker

From project root:
```bash
pnpm run nargo  # Complete workflow: compile → execute → prove → test
```

This automatically copies artifacts to `worker/container_src/`:
- `circuit.json` (from compile)
- `circuit.gz` (from execute)
- `.bb-crs/` (from prove)

Or use individual commands:
```bash
pnpm run compile  # Compiles and copies circuit.json
pnpm run execute  # Executes and copies circuit.gz
pnpm run prove    # Proves and copies CRS files
```

Manual copy:
```bash
cp target/circuit.json ../worker/container_src/
cp target/circuit.gz ../worker/container_src/
```

## Proof Generation

The circuit outputs constraints that Barretenberg proves:

```bash
# Generate proof (from circuit dir)
bb prove -b target/circuit.json -w target/circuit.gz -o target/

# Verify proof
bb verify -k target/vk -p target/proof
```

Production proofs are generated by the worker container.

## Circuit Stats

- Max moves: 500
- Maze size: 41×41 = 1,681 cells
- Gate count: ~32,000 (optimized)
- Proof time: ~2-5s (in container)

## Troubleshooting

**Compilation fails**: Ensure Noir version matches `Nargo.toml`
```bash
nargo --version  # Should be 1.0.0-beta.9+
```

**Test failures**: Regenerate maze if `maze_config.nr` is out of sync
```bash
pnpm run generate
```

**Proof generation fails**: Check that `circuit.json` and `circuit.gz` exist
```bash
ls -la target/
```
