# Noir Circuit

Zero-knowledge circuit for maze solution verification using Noir and Barretenberg.

## Overview

This circuit proves a player successfully navigated from start (1,1) to end (40,40) without revealing their specific moves.

**Inputs (Private):**
- `moves: [u8; 500]` - Move sequence (0=NORTH, 1=EAST, 2=SOUTH, 3=WEST)
- `maze_seed: Field` - Seed identifying the maze

**Outputs (Public):**
- Zero-knowledge proof of valid solution

## How It Works

```
1. Verify maze seed matches expected maze
2. Start at position (1, 1)
3. For each move:
   - Validate bounds (position < 41)
   - Check no wall collision (grid[pos] == 1)
   - Update position based on direction
4. Assert final position is (40, 40)
```

**Invalid moves:** Directions >3 result in no-op (position unchanged). This is secure because no-ops cannot help reach the goal or bypass wall checks.

## Files

- `src/main.nr` - Circuit logic with position tracking and validation
- `src/maze_config.nr` - Generated 41×41 grid and seed (from `generate_maze.py`)
- `src/test_solutions.nr` - Test cases for valid/invalid solutions
- `Nargo.toml` - Project configuration
- `Prover.toml` - Witness inputs (generated from maze solver)

## Security Guarantees

The circuit cryptographically proves:
1. **Maze identity** - Correct seed used
2. **Start position** - Begin at (1, 1)
3. **Valid moves** - Only ±1 movement per step
4. **Bounds checking** - All positions within 41×41 grid
5. **Wall detection** - No walking through walls (grid value = 1)
6. **Goal achievement** - Reach (40, 40)

## Usage

### Prerequisites

- Noir CLI v1.0.0-beta.9+ (`noirup`)
- Barretenberg CLI (optional, for local proving)

### Basic Commands

```bash
# Compile circuit
nargo compile

# Run tests
nargo test

# Generate witness from Prover.toml
nargo execute

# Type check without execution
nargo check
```

### Generate New Maze

From project root:

```bash
# Use default seed (2918957128)
pnpm run generate

# Use custom seed
python3 generate_maze.py <seed> --no-preview

# Rebuild circuit
pnpm run nargo
```

This updates `src/maze_config.nr` and `Prover.toml`.

### Complete Workflow

From project root:
```bash
pnpm run nargo
```

Runs: compile → execute → prove → test and copies artifacts to `worker/container_src/`:
- `circuit.json` - Circuit bytecode
- `circuit.gz` - Witness data
- `.bb-crs/` - Trusted setup files

Individual steps:
```bash
pnpm run compile  # Compile and copy circuit.json
pnpm run execute  # Generate witness and copy circuit.gz
pnpm run prove    # Generate proof and copy CRS files
```

## Proof Generation

### Local (Optional)

```bash
# From circuit directory
bb prove -b target/circuit.json -w target/circuit.gz -o target/
bb verify -k target/vk -p target/proof
```

### Production

Proofs are generated by the Cloudflare Worker container using Barretenberg CLI. See [worker/README.md](../worker/README.md).

## Circuit Statistics

- **Max moves:** 500
- **Grid size:** 41×41 (1,681 cells)
- **Gate count:** ~32,000 (optimized with no-op handling)
- **Proof time:** ~2-5 seconds (in container)

## Troubleshooting

**Compilation fails:**
```bash
nargo --version  # Should be 1.0.0-beta.9+
cd circuit-noir && rm -rf target && nargo compile
```

**Tests fail:**
```bash
# Regenerate maze if out of sync
pnpm run generate
nargo test
```

**Missing artifacts:**
```bash
ls -la target/  # Verify circuit.json and circuit.gz exist
```

## Resources

- [Noir Language Documentation](https://noir-lang.org/)
- [Barretenberg Proving System](https://github.com/AztecProtocol/aztec-packages/tree/master/barretenberg)
- [Parent README](../README.md)
